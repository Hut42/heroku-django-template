files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/cloud-init.conf" :
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/celery/*.log
container_commands:
  01_mkdir_for_log_and_pid:
    command: "mkdir -p /var/log/celery/ /var/run/celery/"
  02_uninstall_pycurl:
    command: '/opt/python/run/venv/bin/pip uninstall -y pycurl'
  03_install_pycurl:
    command: 'PYCURL_SSL_LIBRARY=openssl && PYTHON_INSTALL_LAYOUT="" && /opt/python/run/venv/bin/pip install --compile --global-option="--with-openssl" --no-cache-dir pycurl===7.43.0.1'
  04_install_gevent:
    command: '/opt/python/run/venv/bin/pip install --no-input gevent'
  05_celery_configure:
    command: "cp .ebextensions/celery-worker.sh /opt/elasticbeanstalk/hooks/appdeploy/post/ && chmod 744 /opt/elasticbeanstalk/hooks/appdeploy/post/celery-worker.sh"
    cwd: "/opt/python/ondeck/app"
  06_celery_run:
    command: "/opt/elasticbeanstalk/hooks/appdeploy/post/celery-worker.sh"
